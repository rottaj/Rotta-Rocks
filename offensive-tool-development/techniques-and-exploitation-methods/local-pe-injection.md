---
description: >-
  Similarly to Reflective DLL Injection, Local PE Injection allows us to execute
  another PE entirely in memory of the running process. Note, this is done in
  the local host process and is not remote.
---

# Local PE Injection

## Introduction

Local PE Injection is a way to utilize Position Indepened Code (PIC) to execute a PE entirely in memory of the host process. We can build a PE loader to run malicious binaries entirely in memory to avoid detection. An example would be to run **mimikatz.exe** or **Sharphound.exe** in memory.

## Local PE Injection Steps

Like Reflective DLL injection there are requirements to locally injection a PE in memory.

&#x20;  1.) Allocate enough memory for the PE file buffer.

&#x20;  2.) Copy the PE sections to the allocated buffer.

&#x20;  3.) Patch the PE's relocations.

&#x20;  4.) Path the PE's Import Address Table (IAT)

&#x20;  5.) Set memory permissions for each of the PE's sections.

&#x20;  6.) Execute the PE's entry point.



I wont go over allocating memory and copying to the bufer but I'll summarize. ReadFile -> HeapAlloc -> memcpy pSections to allocated memory.



## Patch IAT







## Fix Memory Permissions







## Patch Base Relocations
